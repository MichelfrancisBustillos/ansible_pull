- name: Deploy Tailscale
  block:
    - name: Tailscale Role
      roles:
        - role: artis3n.tailscale
          vars:
            tailscale_auth_key: !vault |
              $ANSIBLE_VAULT;1.1;AES256
              31663265633530313166666265633437663835303736663264393437336237363362663130353536
              3333643464393439386631373630663133353731386139390a663937353863666632333062336339
              38343735643232663037616531343362633536396264376366366164373836386366326162623932
              3332323738326235310a343233636266316263653339323561353062373164346265363266313536
              38326232333166396234633066303239386436333764643530376636346534383937663538383133
              32373830653964393130396161633239653236653533333731613833636332326363376261656333
              623464363331303335313430346232313065
            tailscale_args: "--ssh"

  rescue:
    - name: Handle failure
      ansible.builtin.debug:
        msg: "An error occurred during tailscale deployment."
    - name: Increment failure counter
      ansible.builtin.set_fact:
        failure_counter: "{{ failure_counter | default(0) | int + 1 }}"