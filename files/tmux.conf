#############################
# General Settings
#############################

set -g @continuum-restore 'on'

# remap prefix from 'C-b' to 'C-a'
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support for scrolling and pane resizing
set-option -g mouse on
# Disable right click menu
unbind -n MouseDown3Pane

# Aggressively kill unresponsive panes
set-option -s escape-time 200
set-option -sg repeat-time 600

# Start window and pane indexing at 1 (instead of 0)
set-option -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Highlight window with new activity
set -g monitor-activity on

# Force tmux to use full color range
set -g default-terminal "screen-256color"

# Add binding to reload tmux.conf for fast, iterative development
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded!"

#############################
# Status Bar Settings
#############################

# Status bar: Improve readability
set-option -g status-bg blue      # Background color of the status bar
set-option -g status-fg black     # Foreground color of the status bar
set-option -g status-interval 10  # Refresh the status bar every 10 seconds
set -g status-justify centre     # Center-align the status bar content
set -g status-right-length 60
set -g status-left-length 60

set-option -g status-right " %H:%M | %Y-%m-%d | #(whoami)@#H "
set-option -g status-left "#{prefix_highlight} #{pane_current_path}"
#####################################
# Nesting Local and Remote Sessions
#####################################

# Idea is to turn off all key bindings and prefix handling on local session,
# so that all keystrokes are passed to inner/remote session

bind -T root F12  \
    set prefix None \;\
    set key-table off \;\
    set status-style "fg=colour245,bg=default" \;\
    set window-status-current-format "#[fg=colour245,bg=default] #I:#W " \;\
    set window-status-current-style "fg=colour245,bg=colour238" \;\
    if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
    refresh-client -S \;\

bind -T off F12 \
    set -u prefix \;\
    set -u key-table \;\
    set -u status-style \;\
    set -u window-status-current-style \;\
    set -u window-status-current-format \;\
    refresh-client -S

######################
# Plugin Management
######################

# List of plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-sidebar'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
set-environment -g TMUX_PLUGIN_MANAGER_PATH "~/.config/tmux/plugins"
run '~/.config/tmux/plugins/tpm/tpm'